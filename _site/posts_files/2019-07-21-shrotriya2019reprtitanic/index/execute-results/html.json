{
  "hash": "34e67cee19239f78c6058662201ab3a8",
  "result": {
    "markdown": "---\ntitle: \"Reproducibility Challenge: Titanic Survivors Plot\"\ndescription: |\n    Using the `Tidyverse` to reproduce a plot on the\n    survivorship of the Titanic\ncategories: [tidyverse, rstats, reproducibility]\ndate: \"2019-07-21\"\nimage: images/logo-01.jpg\nslug: shrotriya2019reprtitanic\nbibliography: ../../refs.bib\nformat: \n  html:\n    code-link: true\nexecute:\n  echo: true\neditor_options: \n  markdown: \n    wrap: 80\n---\n\n\n## Background\n\nIn the February 2019 issue of [Significance\nMagazine](https://rss.onlinelibrary.wiley.com/doi/full/10.1111/j.1740-9713.2019.01229.x)\nnotably featured a story of the titanic disaster [@friendly2019titanicviz] and\nvisualization of key survival statistics. As a fan of `R` and data visualization\nI enjoyed this article and recommended it to anyone with similar interests.\nAlthough the subject is rather tragic, by reading the article I did get a better\nappreciation of how the information of the crash survivorship was conveyed to\nthe general public through data visualization.\n\n<aside>\n\n![cover](images/feb-2019-significance-cover.png){#main-src-cover\nfig-alt=\"cover alt-text\" fig-align=\"center\" width=\"24cm\"}\n\n</aside>\n\n## Reproducibility Challenge\n\nOf particular note in the article was the following data visualization poster\nprinted shortly after the tragedy:\n\n![G.Bron's chart of \"The Loss of the 'Titanic'\", from _The Sphere_, 4 May 1912](images/main-titanic-poster.png){#main-src-poster alt=\"G.Bron's chart of The Loss of the Titanic, from The Sphere, 4 May 1912\" fig-alt=\"G.Bron's chart of The Loss of the Titanic, from The Sphere, 4 May 1912\"\nfig-align=\"center\" width=\"12cm\"}\n\nI found this to be a very cool data visualization of the survivorship by class,\ngender, and adulthood. As a statistics graduate student, I care a lot about\nreproducibility of results not only as a basic check, but to really appreciate\nthe results and more importantly any implicit assumptions behind the results. So\nthis led to the following goal and effectively this blogpost:\n\n<aside>\n\n**Note:** Replicability is better, but reproducibility is a good start and often\na more practically feasible undertaking\n\n</aside>\n\n**Goal:** Given the same Titanic survivors data could we recreate a similar\nlooking chart using `R` and specifically the `tidyverse` set of tools?\n\n## Collecting and cleaning the data\n\nFirst let's begin by loading our required data cleaning and plotting packages.\nFirst we will load the required libraries needed for the analysis.\n\n\n::: {.cell}\n\n:::\n\n\nIn the article the authors cite several resources for collecting the data for\nthis task. Per the article we note that the data is already *pre-baked* into `R`\nand located in `datasets::Titanic` when `R` loads, which is convenient\nüòé.\n\nWe can source the data and start cleaning it for our exploration, using the\nhandy `clean_names` function for column name cleaning and converting\nvarious categorical variables (*age, sex, survivorship, and passenger class*) to\nfactors for easy plotting later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Basic cleaning of names and filtering out non-zero counts\nt1 <- datasets::Titanic %>%\n        as_tibble() %>%\n        clean_names(dat = .) %>%\n        filter(.data = ., n != 0) %>%\n        mutate(.data = .,\n                      new_sex = ifelse(age == \"Child\", age, sex),\n                      n_sgnd = ifelse(survived == \"No\", -1*n, n)) %>%\n        select(class, new_sex, survived, n_sgnd)\n\n# Passenger (non-crew) level aggregation\nt2 <- t1 %>%\n        filter(class != \"Crew\") %>%\n        mutate(class = \"Pass.\") %>%\n        group_by(class, new_sex, survived) %>%\n        summarize(n_sgnd = sum(n_sgnd))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'class', 'new_sex'. You can override using\nthe `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\n# Crew (non-passenger) level aggregation\nt3 <- t1 %>%\n        mutate(class = \"Pass.\\nCrew\") %>%\n        group_by(class, new_sex, survived) %>%\n        summarize(n_sgnd = sum(n_sgnd))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'class', 'new_sex'. You can override using\nthe `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\n# Combined cleaned plotting dataset\nttnc_cln <- t1 %>%\n              bind_rows(t2) %>%\n              bind_rows(t3) %>%\n              mutate(.data = .,\n                            class = as.factor(class),\n                            new_sex = as.factor(new_sex),\n                            survived = as.factor(survived))\n\n# Display first 8 rows in a nice centered table\nttnc_cln %>%\n  slice(.data = ., 1:8) %>%\n  kable(x = ., align = 'c')\n```\n\n::: {.cell-output-display}\n| class | new_sex | survived | n_sgnd |\n|:-----:|:-------:|:--------:|:------:|\n|  3rd  |  Child  |    No    |  -35   |\n|  3rd  |  Child  |    No    |  -17   |\n|  1st  |  Male   |    No    |  -118  |\n|  2nd  |  Male   |    No    |  -154  |\n|  3rd  |  Male   |    No    |  -387  |\n| Crew  |  Male   |    No    |  -670  |\n|  1st  | Female  |    No    |   -4   |\n|  2nd  | Female  |    No    |  -13   |\n:::\n:::\n\n\nLooks nice. As you can see, the data cleaning was done in stages where 3\ndatasets `t1, t2, t3` were built up. Essentially by staring at the plot it is\nclear that plots are split by class i.e. $1^{st}$ Class, $2^{nd}$ Class etc.\nThis is the cleaned `t1` data frame. However there are aggregate versions of\nthese classes at combined *Passenger* level and *Passenger and Crew* level which\nare the `t2` and `t3` tibbles respectively. Finally we concatenate them together\ninto `ttnc_cln` and ensure our categorical variables are cast as `factors`.\n\nNext step - plotting!\n\n## Plotting the Data\n\nThe main chart object is a barplot by sex and adult status and faceted by\npassenger class i.e. first class, second class etc. Great, let's do it!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nout_plot <- ttnc_cln %>%\n              ggplot(data = .,\n                              aes(x = new_sex, y = n_sgnd, fill = survived)) +\n              geom_bar(stat = \"identity\") +\n              facet_wrap(~ class, ncol = 1,\n                                  strip.position = \"right\",\n                                  scales = \"free_y\") +\n              coord_flip() +\n              scale_fill_manual(values=c(\"#3C4144\", \"#D2D3D1\")) +\n              theme_bw() +\n              theme(panel.background = element_rect(fill = \"#969898\"),\n                             panel.grid.major = element_blank(),\n                             panel.grid.minor = element_blank(),\n                             axis.title.x = element_blank(),\n                             axis.title.y = element_blank(),\n                             strip.text.y = element_text(angle = 360),\n                             legend.position = \"none\") +\n              scale_y_continuous(breaks=seq(-1500,600,150)) +\n              labs(title = 'The LOSS of the \"TITANIC\"',\n                            subtitle = glue::glue(\"The Results Analyzed and Shown\",\n                                                  'in a special \"Sphere\" Diagram',\n                                                  .sep = \" \"),\n                            caption = glue::glue(\"Note: The Black color indicates\",\n                                                 \"Passengers and Crew NOT SAVED.\",\n                                                 \"The White color indicates SAVED.\",\n                                                  .sep = \" \"))\n\nout_plot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/setup_ttnic_01_02-1.png){width=672}\n:::\n:::\n\n\n## Conclusion\n\n-   Overall looks like the plot was able to be reproduced to a decent level of\n    accuracy\n-   To get the colors to be close to the plot, I simply opened the [article\n    online](https://rss.onlinelibrary.wiley.com/doi/full/10.1111/j.1740-9713.2019.01229.x)\n    and used the [Colorzilla for Chrome](http://colorzilla.com/chrome/) addin to\n    select the color manually. This is a really nice tool to use for reproducing\n    colors viewed through a browser\n-   I don't quite like that the non-survivors here are shown on a negative\n    scale, but this was the quick hack I could perform to get bars flipped for\n    non-survivors vs. survivors\n-   **Summary:** Overall this was a really fun challenge and I learned a lot\n    about old-school data visualization using the glorius modern `tidyverse`\n    ecosystem we have at our fingertips. Will do a similar reproducibility\n    challenge again for sure ‚úåÔ∏è. Have fun playing around\n    with the above and please post in the comments any questions/feedback you\n    may have üëç.\n\n## Acknowledgments {.appendix}\n\nI'd like to thank Salil Shrotriya for creating the preview image for this post.\nThe hex sticker `png` files were sourced from\n[here](https://github.com/rstudio/hex-stickers).\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}